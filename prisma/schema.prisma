generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id           String     @id @default(cuid())
  email        String     @unique
  password     String
  name         String
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
  createdBy    String?
  invoices     Invoice[]
  roles        UserRole[]
  creator      User?      @relation("UserCreator", fields: [createdBy], references: [id])
  createdUsers User[]     @relation("UserCreator")

  @@map("users")
}

model Role {
  id          String     @id @default(cuid())
  name        String     @unique
  description String?
  permissions String
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  users       UserRole[]

  @@map("roles")
}

model UserRole {
  id     String @id @default(cuid())
  userId String
  roleId String
  role   Role   @relation(fields: [roleId], references: [id], onDelete: Cascade)
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, roleId])
  @@map("user_roles")
}

model Category {
  id          String    @id @default(cuid())
  title       String    @unique
  description String?
  isDefault   Boolean   @default(false)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  products    Product[]

  @@map("categories")
}

model Product {
  id                String        @id @default(cuid())
  name              String
  price             Decimal       @db.Decimal(10, 2)
  description       String?
  categoryId        String
  stockQuantity     Int           @default(0)
  lowStockThreshold Int           @default(0)
  createdAt         DateTime      @default(now())
  updatedAt         DateTime      @updatedAt
  invoiceItems      InvoiceItem[]
  category          Category      @relation(fields: [categoryId], references: [id])

  @@map("products")
}

model Patient {
  id            String        @id @default(cuid())
  patientId     Int           @default(autoincrement())
  patientName   String
  patientMobile String        @unique
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  invoices      Invoice[]
  appointments  Appointment[]

  @@map("patients")
}

model Appointment {
  id              String   @id @default(cuid())
  patientId       String
  appointmentDate DateTime
  status          String   @default("scheduled")
  reason          String?
  notes           String?
  branch          String?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  patient         Patient  @relation(fields: [patientId], references: [id])
  invoice         Invoice?

  @@map("appointments")
}

model Invoice {
  id             String        @id @default(cuid())
  invoiceNo      String        @unique
  subtotal       Decimal       @default(0) @db.Decimal(10, 2)
  discount       Decimal       @default(0) @db.Decimal(10, 2)
  discountType   String        @default("percentage")
  discountAmount Decimal       @default(0) @db.Decimal(10, 2)
  totalAmount    Decimal       @db.Decimal(10, 2)
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  createdBy      String
  patientId      String
  branch         String?
  corporateId    String?
  paidAmount     Decimal       @default(0) @db.Decimal(10, 2)
  appointmentId  String?       @unique
  items          InvoiceItem[]
  user           User          @relation(fields: [createdBy], references: [id])
  patient        Patient       @relation(fields: [patientId], references: [id])
  appointment    Appointment?  @relation(fields: [appointmentId], references: [id])

  @@map("invoices")
}

model InvoiceItem {
  id             String   @id @default(cuid())
  invoiceId      String
  productId      String?
  productName    String
  quantity       Int
  unitPrice      Decimal  @db.Decimal(10, 2)
  total          Decimal  @db.Decimal(10, 2)
  isManual       Boolean  @default(false)
  discount       Decimal  @default(0) @db.Decimal(10, 2)
  discountAmount Decimal  @default(0) @db.Decimal(10, 2)
  discountType   String   @default("percentage")
  invoice        Invoice  @relation(fields: [invoiceId], references: [id], onDelete: Cascade)
  product        Product? @relation(fields: [productId], references: [id])

  @@map("invoice_items")
}

model Counter {
  id    String @id @default(cuid())
  name  String @unique
  value Int    @default(0)

  @@map("counters")
}
